<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    {% seo %}
    <link rel="stylesheet" href="{{ '/assets/styles.css' | relative_url }}">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  </head>
  <body>
    <div id="sidebar-overlay"></div>
    <div id="command-palette-overlay">
      <div id="command-palette">
        <input type="text" id="command-input" placeholder="Type a command or search sections...">
        <ul id="command-list"></ul>
      </div>
    </div>
    <div id="settings-modal-overlay">
      <div id="settings-modal">
        <h2>‚öôÔ∏è Settings</h2>
        <div class="settings-grid">
          <div class="setting-group">
            <label>Font Size: <span id="font-size-val">16px</span></label>
            <input type="range" id="font-size-input" min="12" max="24" value="16" style="width: 100%;">
          </div>
          <div class="setting-group">
            <label>Theme Color</label>
            <input type="color" id="theme-color-input" value="#159957" style="width: 100%; height: 40px;">
          </div>
        </div>
        
        <h3>Features</h3>
        <div class="settings-btn-grid">
          <button id="dark-mode-toggle" class="settings-action-btn">üåô Dark Mode</button>
          <button id="zen-mode-toggle" class="settings-action-btn">üßò Zen Mode</button>
          <button id="checklist-mode-btn" class="settings-action-btn">‚òëÔ∏è Checklist</button>
          <button id="keyboard-toggle-btn" class="settings-action-btn">‚å®Ô∏è Visualizer</button>
          <button id="dashboard-btn" class="settings-action-btn">üìä Dashboard</button>
          <button id="quick-ref-btn" class="settings-action-btn">üÉè Quick Ref</button>
          <button id="print-btn" class="settings-action-btn">üñ®Ô∏è Print PDF</button>
          <button id="share-btn" class="settings-action-btn">üîó Share</button>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button id="reset-settings-btn" style="padding: 8px 16px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer;">Reset</button>
          <button id="close-settings-btn" style="padding: 8px 16px; border-radius: 8px; background: var(--heading-color); color: white; border: none; cursor: pointer;">Close</button>
        </div>
      </div>
    </div>
    <div id="shortcuts-overlay">
      <div id="shortcuts-modal">
        <h2>‚å®Ô∏è Site Shortcuts</h2>
        <ul class="shortcut-list">
          <li><span>Focus Search</span> <code>/</code></li>
          <li><span>Command Palette</span> <code>Cmd</code> + <code>K</code></li>
          <li><span>Show this help</span> <code>?</code></li>
          <li><span>Close overlays</span> <code>Esc</code></li>
        </ul>
        <button id="close-shortcuts-btn" style="width:100%; padding: 10px; background: var(--heading-color); color: white; border: none; border-radius: 8px; cursor: pointer;">Close</button>
      </div>
    </div>
    <div id="print-shortcuts-modal">
      <button id="print-shortcuts-close">Close</button>
      <div id="print-shortcuts-content"></div>
    </div>
    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>
    <div id="mobile-fab-container">
      <div id="mobile-fab-menu">
        <button id="fab-toc-btn" class="fab-action-btn">üìë Contents</button>
        <button id="fab-search-btn" class="fab-action-btn">üîç Search</button>
        <button id="fab-settings-btn" class="fab-action-btn">‚öôÔ∏è Settings</button>
      </div>
      <button id="mobile-fab-main">‚ûï</button>
    </div>
    <button id="exit-zen-btn">Exit Zen Mode</button>
    
    <div id="keyboard-visualizer">
      <div class="viz-toolbar">
        <button id="viz-macro-btn" class="viz-btn">üî¥ Record Macro</button>
        <button id="viz-game-btn" class="viz-btn">üéÆ Game Mode</button>
      </div>
      <div id="macro-log">Press keys to record...</div>
      <div id="game-ui">
        <div id="game-score">Score: 0</div>
        <div id="game-question">Loading...</div>
        <div id="game-feedback"></div>
        <button id="game-skip-btn" class="viz-btn" style="margin-top:5px;">Skip Question</button>
      </div>
      <div class="visualizer-hint">Hover over any shortcut in the tables below to visualize keys</div>
      <div class="kb-row">
        <div class="kb-key" data-key="`">`</div>
        <div class="kb-key" data-key="1">1</div>
        <div class="kb-key" data-key="2">2</div>
        <div class="kb-key" data-key="3">3</div>
        <div class="kb-key" data-key="4">4</div>
        <div class="kb-key" data-key="5">5</div>
        <div class="kb-key" data-key="6">6</div>
        <div class="kb-key" data-key="7">7</div>
        <div class="kb-key" data-key="8">8</div>
        <div class="kb-key" data-key="9">9</div>
        <div class="kb-key" data-key="0">0</div>
        <div class="kb-key" data-key="-">-</div>
        <div class="kb-key" data-key="=">=</div>
        <div class="kb-key kb-key-wide" data-key="delete">del</div>
      </div>
      <div class="kb-row">
        <div class="kb-key kb-key-wide" data-key="tab">tab</div>
        <div class="kb-key" data-key="q">Q</div><div class="kb-key" data-key="w">W</div><div class="kb-key" data-key="e">E</div><div class="kb-key" data-key="r">R</div><div class="kb-key" data-key="t">T</div><div class="kb-key" data-key="y">Y</div><div class="kb-key" data-key="u">U</div><div class="kb-key" data-key="i">I</div><div class="kb-key" data-key="o">O</div><div class="kb-key" data-key="p">P</div><div class="kb-key" data-key="[">[</div><div class="kb-key" data-key="]">]</div><div class="kb-key" data-key="\">|</div>
      </div>
      <div class="kb-row">
        <div class="kb-key kb-key-xwide" data-key="caps">caps</div>
        <div class="kb-key" data-key="a">A</div><div class="kb-key" data-key="s">S</div><div class="kb-key" data-key="d">D</div><div class="kb-key" data-key="f">F</div><div class="kb-key" data-key="g">G</div><div class="kb-key" data-key="h">H</div><div class="kb-key" data-key="j">J</div><div class="kb-key" data-key="k">K</div><div class="kb-key" data-key="l">L</div><div class="kb-key" data-key=";">;</div><div class="kb-key" data-key="'">'</div><div class="kb-key kb-key-xwide" data-key="return">return</div>
      </div>
      <div class="kb-row">
        <div class="kb-key kb-key-xwide" data-key="shift">shift</div>
        <div class="kb-key" data-key="z">Z</div><div class="kb-key" data-key="x">X</div><div class="kb-key" data-key="c">C</div><div class="kb-key" data-key="v">V</div><div class="kb-key" data-key="b">B</div><div class="kb-key" data-key="n">N</div><div class="kb-key" data-key="m">M</div><div class="kb-key" data-key=",">,</div><div class="kb-key" data-key=".">.</div><div class="kb-key" data-key="/">/</div><div class="kb-key kb-key-xwide" data-key="shift">shift</div>
      </div>
      <div class="kb-row">
        <div class="kb-key" data-key="fn">fn</div>
        <div class="kb-key" data-key="ctrl">ctrl</div>
        <div class="kb-key" data-key="opt">opt</div>
        <div class="kb-key kb-key-wide" data-key="cmd">cmd</div>
        <div class="kb-key kb-key-space" data-key="space">space</div>
        <div class="kb-key kb-key-wide" data-key="cmd">cmd</div>
        <div class="kb-key" data-key="opt">opt</div>
        <div class="kb-key" data-key="left">‚Üê</div><div class="kb-key" data-key="up">‚Üë</div><div class="kb-key" data-key="down">‚Üì</div><div class="kb-key" data-key="right">‚Üí</div>
      </div>
    </div>

    <!-- Mobile Search Overlay Container -->
    <div id="mobile-search-overlay">
      <button id="close-mobile-search" class="icon-btn" style="position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem;">‚úï</button>
    </div>

    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="app-header">
      <div class="header-left">
        <div class="header-logo">Ô£ø</div>
        <div class="header-title">macOS Cheat Sheet</div>
      </div>
      
      <div class="header-center" id="header-search-container">
        <div class="search-wrapper" style="width: 100%;">
          <input type="text" id="search-input" placeholder="üîç Search cheat sheet..." autocomplete="off">
          <button id="clear-search-btn" title="Clear Search">‚úï</button>
          <button id="voice-search-btn" title="Search with Voice">üé§</button>
          <div id="search-history-dropdown"></div>
        </div>
      </div>

      <div class="header-right">
        <button id="mobile-search-toggle" class="icon-btn">üîç</button>
        <button id="settings-btn" class="icon-btn">‚öôÔ∏è</button>
      </div>
    </header>

    <main id="content" class="main-content" role="main">
      <div class="page-layout">
        <aside id="toc-sidebar" class="toc-sidebar">
          <div id="shortcut-of-the-day"></div>
          <div class="favorites-section">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <h3>‚≠ê Favorites</h3>
              <button id="export-favorites-btn" title="Export Favorites to JSON" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">üì•</button>
            </div>
            <ul id="favorites-list"><li class="favorites-placeholder">Click stars to bookmark sections</li></ul>
          </div>
          <div class="toc-controls">
            <span style="font-size: 0.85rem; font-weight: bold; color: var(--heading-color); text-transform: uppercase;">Contents</span>
            <button id="toc-toggle-btn">Collapse All</button>
          </div>
          <ul id="toc-list"></ul>
        </aside>
        <div class="page-content">
          {{ content }}
        </div>
      </div>

      <footer class="site-footer">
        <div class="footer-legal">
          <p><strong>Idea & Concept:</strong> Kamalesh &nbsp;|&nbsp; <strong>Copyright:</strong> &copy; 2026 Kamalesh. All Rights Reserved.</p>
          <p class="disclaimer">Disclaimer: This guide is not affiliated with, endorsed by, or sponsored by Apple Inc. macOS, Mac, and Apple Silicon are trademarks of Apple Inc. The information provided is for educational purposes only. Use at your own risk.</p>
        </div>
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
        <span class="site-footer-credits" style="display: block; margin-top: 10px; opacity: 0.8;">Last Updated: {{ site.time | date: "%B %d, %Y" }}</span>
      </footer>
    </main>

    <button id="back-to-top" aria-label="Back to Top">‚Üë</button>
    
    <!-- Back to Top Button Script -->
    <script>
      // Scroll Progress Bar Logic
      window.addEventListener('scroll', () => {
        const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        document.getElementById("progress-bar").style.width = scrolled + "%";
      });

      // Back to Top Button Logic
      const backToTopBtn = document.getElementById('back-to-top');
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          backToTopBtn.classList.add('visible');
        } else {
          backToTopBtn.classList.remove('visible');
        }
      });

      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
              e.preventDefault();
              document.querySelector(this.getAttribute('href')).scrollIntoView({
                  behavior: 'smooth'
              });
          });
      });
    </script>

    <!-- Dark Mode & Search Script -->
    <script>
      // Dark Mode Logic
      const toggleBtn = document.getElementById('dark-mode-toggle');
      const html = document.documentElement;
      
      // Check saved preference
      if (localStorage.getItem('theme') === 'dark') {
        html.setAttribute('data-theme', 'dark');
        toggleBtn.textContent = '‚òÄÔ∏è Light Mode';
      }

      toggleBtn.addEventListener('click', () => {
        if (html.getAttribute('data-theme') === 'dark') {
          html.removeAttribute('data-theme');
          localStorage.setItem('theme', 'light');
          toggleBtn.textContent = 'üåô Dark Mode';
        } else {
          html.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
          toggleBtn.textContent = '‚òÄÔ∏è Light Mode';
        }
      });

      // Search Logic
      const searchInput = document.getElementById('search-input');
      const mainContent = document.querySelector('.page-content');
      const historyDropdown = document.getElementById('search-history-dropdown');
      let searchHistory = [];
      try {
        searchHistory = JSON.parse(localStorage.getItem('search_history')) || [];
      } catch (e) {
        searchHistory = [];
      }
      
      // Wrap content in sections for filtering
      // We assume sections start with H2
      if (mainContent) {
        const children = Array.from(mainContent.children);
        let currentWrapper = null;

        children.forEach(child => {
          if (child.tagName === 'H2') {
            currentWrapper = document.createElement('div');
            currentWrapper.className = 'searchable-section';
            mainContent.insertBefore(currentWrapper, child);
            currentWrapper.appendChild(child);
          } else if (currentWrapper && child.tagName !== 'FOOTER' && child.tagName !== 'SCRIPT') {
            currentWrapper.appendChild(child);
          }
        });
      }
      
      // Ensure content is visible by default
      document.querySelectorAll('.searchable-section').forEach(section => {
        section.style.display = '';
      });

      const clearSearchBtn = document.getElementById('clear-search-btn');

      function removeHighlights() {
        const marks = document.querySelectorAll('mark.search-highlight');
        marks.forEach(mark => {
          const parent = mark.parentNode;
          parent.replaceChild(document.createTextNode(mark.textContent), mark);
          parent.normalize();
        });
      }

      function highlightMatches(term) {
        removeHighlights();
        if (!term) return;

        const walker = document.createTreeWalker(document.querySelector('.page-content'), NodeFilter.SHOW_TEXT, null, false);
        const nodes = [];
        while(walker.nextNode()) nodes.push(walker.currentNode);

        nodes.forEach(node => {
          if (node.parentNode.tagName === 'SCRIPT' || node.parentNode.tagName === 'STYLE' || node.parentNode.tagName === 'MARK') return;
          
          const text = node.textContent;
          if (text.toLowerCase().includes(term)) {
             const fragment = document.createDocumentFragment();
             let lastIdx = 0;
             const lowerText = text.toLowerCase();
             let idx = lowerText.indexOf(term);
             
             while (idx !== -1) {
               fragment.appendChild(document.createTextNode(text.substring(lastIdx, idx)));
               const mark = document.createElement('mark');
               mark.className = 'search-highlight';
               mark.textContent = text.substring(idx, idx + term.length);
               fragment.appendChild(mark);
               lastIdx = idx + term.length;
               idx = lowerText.indexOf(term, lastIdx);
             }
             fragment.appendChild(document.createTextNode(text.substring(lastIdx)));
             node.parentNode.replaceChild(fragment, node);
          }
        });
      }

      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          const term = e.target.value.toLowerCase();
          
          if (clearSearchBtn) {
            clearSearchBtn.classList.toggle('visible', term.length > 0);
          }

          document.querySelectorAll('.searchable-section').forEach(section => {
            const text = section.innerText.toLowerCase();
            section.style.display = text.includes(term) ? '' : 'none';
          });

          if (term.length > 1) {
            highlightMatches(term);
          } else {
            removeHighlights();
          }
        });
        
        // Trigger initial search if value exists (e.g. browser restore)
        if (searchInput.value) {
          searchInput.dispatchEvent(new Event('input'));
        }
      }

      // Search History Logic
      const popularTerms = ["screenshot", "terminal", "reset", "wifi", "force quit", "hidden files"];

      function renderSearchHistory() {
        if (!historyDropdown) return;
        historyDropdown.innerHTML = '';
        
        // History
        if (searchHistory.length > 0) {
            const header = document.createElement('div');
            header.textContent = 'Recent';
            header.style.cssText = 'padding: 8px 12px; font-size: 0.75rem; color: var(--text-color); opacity: 0.5; font-weight: bold; text-transform: uppercase;';
            historyDropdown.appendChild(header);
            
            searchHistory.forEach(term => {
                addDropdownItem('üïí ' + term, term);
            });
        }

        // Suggestions
        const suggestions = popularTerms.filter(term => !searchHistory.includes(term));
        if (suggestions.length > 0) {
            const header = document.createElement('div');
            header.textContent = 'Popular';
            header.style.cssText = 'padding: 8px 12px; font-size: 0.75rem; color: var(--text-color); opacity: 0.5; font-weight: bold; text-transform: uppercase; border-top: 1px solid var(--glass-border); margin-top: 4px;';
            if (searchHistory.length === 0) header.style.borderTop = 'none';
            historyDropdown.appendChild(header);

            suggestions.forEach(term => {
                addDropdownItem('üî• ' + term, term);
            });
        }
      }

      function addDropdownItem(text, value) {
          const div = document.createElement('div');
          div.className = 'history-item';
          div.textContent = text;
          div.addEventListener('mousedown', (e) => { // mousedown fires before blur
            e.preventDefault();
            searchInput.value = term;
            searchInput.dispatchEvent(new Event('input'));
            historyDropdown.classList.remove('visible');
            saveSearchTerm(value);
          });
          historyDropdown.appendChild(div);
      }

      function saveSearchTerm(term) {
        if (!term || term.length < 2) return;
        searchHistory = searchHistory.filter(t => t !== term);
        searchHistory.unshift(term);
        if (searchHistory.length > 5) searchHistory.pop();
        localStorage.setItem('search_history', JSON.stringify(searchHistory));
      }

      if (searchInput) {
        searchInput.addEventListener('focus', () => {
          renderSearchHistory();
          if (historyDropdown.children.length > 0 && historyDropdown) historyDropdown.classList.add('visible');
        });

        searchInput.addEventListener('blur', () => {
          if (historyDropdown) historyDropdown.classList.remove('visible');
          saveSearchTerm(searchInput.value);
        });

        if (clearSearchBtn) {
          clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
            searchInput.focus();
          });
        }

        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            saveSearchTerm(searchInput.value);
            if (historyDropdown) historyDropdown.classList.remove('visible');
            searchInput.blur();
          }
        });
      }

      // Voice Search Logic
      const voiceSearchBtn = document.getElementById('voice-search-btn');
      
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.continuous = false;
        recognition.lang = 'en-US';
        recognition.interimResults = false;

        if (voiceSearchBtn) {
          voiceSearchBtn.addEventListener('click', () => {
            if (voiceSearchBtn.classList.contains('listening')) {
              recognition.stop();
            } else {
              recognition.start();
            }
          });
        }

        recognition.onstart = () => {
          if (voiceSearchBtn) voiceSearchBtn.classList.add('listening');
        };

        recognition.onend = () => {
          if (voiceSearchBtn) voiceSearchBtn.classList.remove('listening');
        };

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          if (searchInput) {
            searchInput.value = transcript;
            searchInput.dispatchEvent(new Event('input'));
            searchInput.focus();
            saveSearchTerm(transcript);
          }
        };
      } else {
        if (voiceSearchBtn) voiceSearchBtn.style.display = 'none';
      }

      // Keyboard Shortcut to Focus Search
      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && searchInput && document.activeElement !== searchInput) {
          e.preventDefault();
          searchInput.focus();
        }
      });

      // Zen Mode Logic
      const zenToggle = document.getElementById('zen-mode-toggle');
      const exitZenBtn = document.getElementById('exit-zen-btn');
      const quickRefBtn = document.getElementById('quick-ref-btn');
      
      function toggleZenMode() {
        document.body.classList.toggle('zen-mode');
        document.body.classList.remove('quick-ref-mode'); // Ensure mutually exclusive
      }

      function toggleQuickRefMode() {
        document.body.classList.toggle('quick-ref-mode');
        document.body.classList.remove('zen-mode'); // Ensure mutually exclusive
        if (document.body.classList.contains('quick-ref-mode')) {
          exitZenBtn.textContent = 'Exit Quick Ref';
        } else {
          exitZenBtn.textContent = 'Exit Zen Mode';
        }
      }

      zenToggle.addEventListener('click', toggleZenMode);
      quickRefBtn.addEventListener('click', toggleQuickRefMode);
      
      exitZenBtn.addEventListener('click', () => {
        document.body.classList.remove('zen-mode');
        document.body.classList.remove('quick-ref-mode');
      });
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (document.body.classList.contains('zen-mode')) toggleZenMode();
          if (document.body.classList.contains('quick-ref-mode')) toggleQuickRefMode();
        }
      });

      // Share Button Logic
      const shareBtn = document.getElementById('share-btn');
      shareBtn.addEventListener('click', () => {
        const activeLink = document.querySelector('.toc-sidebar a.active');
        let url = window.location.href.split('#')[0];
        if (activeLink) {
          url += activeLink.getAttribute('href');
        }
        navigator.clipboard.writeText(url).then(() => {
          const originalText = shareBtn.textContent;
          shareBtn.textContent = '‚úÖ Copied!';
          setTimeout(() => shareBtn.textContent = originalText, 2000);
        });
      });

      // Print PDF Logic
      document.getElementById('print-btn').addEventListener('click', () => {
        window.print();
      });

      // Mobile Menu Logic
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const sidebar = document.getElementById('toc-sidebar');
      const overlay = document.getElementById('sidebar-overlay');

      function toggleMobileMenu() {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      }

      mobileMenuBtn.addEventListener('click', toggleMobileMenu);
      overlay.addEventListener('click', toggleMobileMenu);

      // Favorites Logic
      const favoritesList = document.getElementById('favorites-list');
      let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

      function updateFavoritesUI() {
        favoritesList.innerHTML = '';
        if (favorites.length === 0) {
          favoritesList.innerHTML = '<li class="favorites-placeholder">Click stars to bookmark</li>';
        } else {
          favorites.forEach(id => {
            const header = document.getElementById(id);
            if (header) {
              const li = document.createElement('li');
              const a = document.createElement('a');
              a.textContent = header.textContent.replace('‚≠ê', '').trim();
              a.href = '#' + id;
              li.appendChild(a);
              favoritesList.appendChild(li);
            }
          });
        }

        document.querySelectorAll('.favorite-btn').forEach(btn => {
          const id = btn.getAttribute('data-id');
          if (favorites.includes(id)) {
            btn.classList.add('active');
            btn.textContent = '‚òÖ';
          } else {
            btn.classList.remove('active');
            btn.textContent = '‚òÜ';
          }
        });
      }

      function toggleFavorite(id) {
        if (favorites.includes(id)) {
          favorites = favorites.filter(fav => fav !== id);
        } else {
          favorites.push(id);
        }
        localStorage.setItem('favorites', JSON.stringify(favorites));
        updateFavoritesUI();
      }

      // Export Favorites Logic
      document.getElementById('export-favorites-btn').addEventListener('click', () => {
        if (favorites.length === 0) {
          alert('No favorites to export!');
          return;
        }
        
        const exportData = favorites.map(id => {
          const header = document.getElementById(id);
          return {
            id: id,
            title: header ? header.textContent.replace('‚≠ê', '').replace('‚òÜ', '').trim() : id,
            url: window.location.href.split('#')[0] + '#' + id
          };
        });

        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportData, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "macos_cheatsheet_favorites.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
      });

      // Command Palette Logic (Cmd+K)
      const cmdPaletteOverlay = document.getElementById('command-palette-overlay');
      const cmdInput = document.getElementById('command-input');
      const cmdList = document.getElementById('command-list');
      let cmdItems = [];
      let cmdHistory = JSON.parse(localStorage.getItem('cmd_history')) || [];

      function openCommandPalette() {
        cmdPaletteOverlay.style.display = 'flex';
        cmdInput.value = '';
        cmdInput.focus();
        populateCommandList();
      }

      function closeCommandPalette() {
        cmdPaletteOverlay.style.display = 'none';
      }

      function populateCommandList() {
        cmdList.innerHTML = '';
        cmdItems = [];

        // Add History
        if (cmdHistory.length > 0) {
          const historyHeader = document.createElement('li');
          historyHeader.innerHTML = '<strong>üïí Recently Visited</strong>';
          historyHeader.style.pointerEvents = 'none';
          historyHeader.style.background = 'transparent';
          cmdList.appendChild(historyHeader);

          cmdHistory.forEach(item => {
            createCmdItem(item.title, () => {
              window.location.hash = item.id;
              addToHistory(item.id, item.title);
            }, 'History', true);
          });
        }

        // Add Actions
        const actions = [
          { title: 'Toggle Dark Mode', action: () => toggleBtn.click(), shortcut: 'Theme' },
          { title: 'Toggle Zen Mode', action: () => toggleZenMode(), shortcut: 'Zen' },
          { title: 'Print to PDF', action: () => window.print(), shortcut: 'Print' },
          { title: 'Export Favorites', action: () => document.getElementById('export-favorites-btn').click(), shortcut: 'Export' }
        ];

        actions.forEach(item => {
          createCmdItem(item.title, item.action, item.shortcut);
        });

        // Add Sections
        document.querySelectorAll('.page-content h2').forEach(header => {
          if (header.id) {
            const title = header.textContent.replace('‚≠ê', '').replace('‚òÜ', '').trim();
            createCmdItem('Go to: ' + title, () => {
              window.location.hash = header.id;
              addToHistory(header.id, title);
            }, 'Section');
          }
        });
      }

      function createCmdItem(text, action, shortcut, isHistory = false) {
        const li = document.createElement('li');
        li.innerHTML = `<span>${text}</span>${shortcut ? `<span class="cmd-shortcut">${shortcut}</span>` : ''}`;
        li.addEventListener('click', () => {
          action();
          closeCommandPalette();
        });
        cmdList.appendChild(li);
        if (!isHistory) {
          cmdItems.push({ element: li, text: text.toLowerCase() });
        }
      }

      // Filter List
      cmdInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        cmdItems.forEach(item => {
          item.element.style.display = item.text.includes(term) ? 'flex' : 'none';
        });
      });

      // Keyboard Shortcuts
      document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          cmdPaletteOverlay.style.display === 'flex' ? closeCommandPalette() : openCommandPalette();
        }
        if (e.key === 'Escape' && cmdPaletteOverlay.style.display === 'flex') {
          closeCommandPalette();
        }
      });
      
      // Close on click outside
      cmdPaletteOverlay.addEventListener('click', (e) => {
        if (e.target === cmdPaletteOverlay) closeCommandPalette();
      });

      function addToHistory(id, title) {
        cmdHistory = cmdHistory.filter(item => item.id !== id);
        cmdHistory.unshift({ id, title });
        if (cmdHistory.length > 5) cmdHistory.pop();
        localStorage.setItem('cmd_history', JSON.stringify(cmdHistory));
      }

      // Settings Modal Logic
      const settingsBtn = document.getElementById('settings-btn');
      const settingsOverlay = document.getElementById('settings-modal-overlay');
      const closeSettingsBtn = document.getElementById('close-settings-btn');
      const resetSettingsBtn = document.getElementById('reset-settings-btn');
      const fontSizeInput = document.getElementById('font-size-input');
      const fontSizeVal = document.getElementById('font-size-val');
      const themeColorInput = document.getElementById('theme-color-input');

      // Load Settings
      const savedFontSize = localStorage.getItem('fontSize') || '16';
      const savedThemeColor = localStorage.getItem('themeColor') || '#159957';

      function applySettings(fontSize, themeColor) {
        document.documentElement.style.setProperty('--base-font-size', fontSize + 'px');
        document.documentElement.style.setProperty('--heading-color', themeColor);
        fontSizeInput.value = fontSize;
        fontSizeVal.textContent = fontSize + 'px';
        themeColorInput.value = themeColor;
      }

      applySettings(savedFontSize, savedThemeColor);

      settingsBtn.addEventListener('click', () => {
        settingsOverlay.style.display = 'flex';
      });

      closeSettingsBtn.addEventListener('click', () => {
        settingsOverlay.style.display = 'none';
      });
      
      settingsOverlay.addEventListener('click', (e) => {
        if (e.target === settingsOverlay) settingsOverlay.style.display = 'none';
      });

      fontSizeInput.addEventListener('input', (e) => {
        const val = e.target.value;
        fontSizeVal.textContent = val + 'px';
        document.documentElement.style.setProperty('--base-font-size', val + 'px');
        localStorage.setItem('fontSize', val);
      });

      themeColorInput.addEventListener('input', (e) => {
        const val = e.target.value;
        document.documentElement.style.setProperty('--heading-color', val);
        localStorage.setItem('themeColor', val);
      });

      resetSettingsBtn.addEventListener('click', () => {
        localStorage.removeItem('fontSize');
        localStorage.removeItem('themeColor');
        applySettings('16', '#159957');
      });

      // Shortcuts Overlay Logic
      const shortcutsOverlay = document.getElementById('shortcuts-overlay');
      const closeShortcutsBtn = document.getElementById('close-shortcuts-btn');

      document.addEventListener('keydown', (e) => {
        if (e.key === '?' && document.activeElement.tagName !== 'INPUT') {
          shortcutsOverlay.style.display = 'flex';
        }
        if (e.key === 'Escape' && shortcutsOverlay.style.display === 'flex') {
          shortcutsOverlay.style.display = 'none';
        }
      });

      closeShortcutsBtn.addEventListener('click', () => shortcutsOverlay.style.display = 'none');
      shortcutsOverlay.addEventListener('click', (e) => {
        if (e.target === shortcutsOverlay) shortcutsOverlay.style.display = 'none';
      });

      // Shortcut of the Day Logic
      function showShortcutOfTheDay() {
        const tables = document.querySelectorAll('.shortcuts-table');
        let shortcutRows = [];
        
        tables.forEach(table => {
          const header = table.querySelector('th');
          // Only select tables that are actually for shortcuts, not settings
          if (header && header.textContent.trim() === 'Shortcut') {
             const rows = table.querySelectorAll('tbody tr');
             shortcutRows = [...shortcutRows, ...Array.from(rows)];
          }
        });

        if (shortcutRows.length === 0) return;

        const randomRow = shortcutRows[Math.floor(Math.random() * shortcutRows.length)];
        const shortcutHtml = randomRow.cells[0].innerHTML;
        const actionText = randomRow.cells[1].textContent;

        const container = document.getElementById('shortcut-of-the-day');
        container.innerHTML = `
          <h3>üí° Random Shortcut Tip</h3>
          <div class="sotd-keys">${shortcutHtml}</div>
          <div class="sotd-action">${actionText}</div>
        `;
        container.classList.add('visible');
      }
      
      // Initialize
      showShortcutOfTheDay();

      // Ensure modes are off by default to prevent hidden content
      document.body.classList.remove('zen-mode', 'quick-ref-mode');
    </script>

    <!-- TOC & Copy Button Script -->
    <script>
      // Generate TOC
      const tocList = document.getElementById('toc-list');
      const headers = document.querySelectorAll('.page-content h2, .page-content h3');
      let currentSublist = null;
      
      headers.forEach(header => {
        if (header.id) {
          const isH2 = header.tagName.toLowerCase() === 'h2';
          
          // Add Favorite Button (Only for H2s to keep UI clean)
          if (isH2) {
            const favBtn = document.createElement('button');
            favBtn.className = 'favorite-btn';
            favBtn.setAttribute('data-id', header.id);
            favBtn.textContent = '‚òÜ';
            favBtn.onclick = (e) => {
              e.stopPropagation();
              toggleFavorite(header.id);
            };
            header.appendChild(favBtn);
          }

          // Create List Item
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.textContent = header.textContent.replace('‚≠ê', '').replace('‚òÜ', '').trim();
          a.href = '#' + header.id;
          a.addEventListener('click', () => addToHistory(header.id, a.textContent));
          li.appendChild(a);

          // Calculate Read Time for H2
          if (isH2) {
            let sectionText = '';
            let nextNode = header.nextElementSibling;
            while (nextNode && nextNode.tagName !== 'H2') {
              sectionText += nextNode.innerText + ' ';
              nextNode = nextNode.nextElementSibling;
            }
            const wordCount = sectionText.trim().split(/\s+/).length;
            const readTime = Math.ceil(wordCount / 200);
            if (readTime > 0) {
              const timeSpan = document.createElement('span');
              timeSpan.className = 'toc-read-time';
              timeSpan.textContent = `${readTime} min`;
              a.appendChild(timeSpan);
            }
          }

          if (isH2) {
            li.className = 'toc-h2-item';
            const ul = document.createElement('ul');
            ul.className = 'toc-sublist';
            li.appendChild(ul);
            currentSublist = ul;
            tocList.appendChild(li);
          } else {
            li.className = 'toc-h3-item';
            if (currentSublist) {
              currentSublist.appendChild(li);
            } else {
              tocList.appendChild(li);
            }
          }
        }
      });

      // Collapse/Expand Logic
      const tocToggleBtn = document.getElementById('toc-toggle-btn');
      let tocExpanded = true;

      tocToggleBtn.addEventListener('click', () => {
        tocExpanded = !tocExpanded;
        document.querySelectorAll('.toc-sublist').forEach(ul => {
          ul.style.display = tocExpanded ? 'block' : 'none';
        });
        tocToggleBtn.textContent = tocExpanded ? 'Collapse All' : 'Expand All';
      });

      // Initialize Favorites
      updateFavoritesUI();

      // Highlight Active TOC Item
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            document.querySelectorAll('.toc-sidebar a').forEach(link => link.classList.remove('active'));
            const id = entry.target.id;
            const link = document.querySelector(`.toc-sidebar a[href="#${id}"]`);
            if (link) link.classList.add('active');
          }
        });
      }, { rootMargin: '-100px 0px -66%' });

      headers.forEach(header => observer.observe(header));

      // Copy to Clipboard Buttons
      document.querySelectorAll('pre').forEach(pre => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-container';
        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);
        
        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.textContent = 'Copy';
        button.addEventListener('click', () => {
          const code = pre.querySelector('code') ? pre.querySelector('code').innerText : pre.innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => button.textContent = 'Copy', 2000);
          });
        });
        wrapper.appendChild(button);
      });

      // Reading Time Estimator
      function calculateReadingTime() {
        const text = document.querySelector('.page-content').innerText;
        const wpm = 200;
        const words = text.trim().split(/\s+/).length;
        const time = Math.ceil(words / wpm);
        document.getElementById('reading-time').innerText = `üìö Estimated reading time: ${time} min`;
      }
      calculateReadingTime();

      // Keyboard Shortcuts Filter & Print Logic
      const shortcutsFilter = document.getElementById('shortcuts-filter');
      const printShortcutsBtn = document.getElementById('print-shortcuts-btn');
      const printShortcutsModal = document.getElementById('print-shortcuts-modal');
      const printShortcutsClose = document.getElementById('print-shortcuts-close');
      const printShortcutsContent = document.getElementById('print-shortcuts-content');

      const categoryMap = {
        'basics': 'The "Must Know" Basics',
        'text': 'Text Editing & Document Control',
        'finder': 'Finder & File Management',
        'screenshots': 'Screenshots & Recording',
        'web': 'Web Browsing',
        'system': 'System & Window Management'
      };

      if (shortcutsFilter) {
        shortcutsFilter.addEventListener('change', (e) => {
          const category = e.target.value;
          const headers = document.querySelectorAll('.page-content h3');
          
          headers.forEach(h3 => {
            let isShortcutSection = false;
            for (const key in categoryMap) {
              if (h3.textContent.includes(categoryMap[key])) {
                isShortcutSection = true;
                break;
              }
            }

            if (isShortcutSection) {
              const table = h3.nextElementSibling;
              if (table && table.tagName === 'TABLE') {
                const shouldShow = category === 'all' || h3.textContent.includes(categoryMap[category]);
                h3.style.display = shouldShow ? '' : 'none';
                table.style.display = shouldShow ? '' : 'none';
              }
            }
          });
        });
        
        // Trigger initial filter state
        if (shortcutsFilter.value !== 'all') {
          shortcutsFilter.dispatchEvent(new Event('change'));
        }
      }

      if (printShortcutsBtn) {
        printShortcutsBtn.addEventListener('click', () => {
          printShortcutsContent.innerHTML = '';
          
          const title = document.createElement('h1');
          title.textContent = 'macOS Keyboard Shortcuts';
          printShortcutsContent.appendChild(title);

          const printNowBtn = document.createElement('button');
          printNowBtn.textContent = 'üñ®Ô∏è Print Now';
          printNowBtn.style.cssText = 'margin-bottom: 2rem; padding: 0.5rem 1rem; cursor: pointer; font-size: 1rem;';
          printNowBtn.onclick = () => window.print();
          printShortcutsContent.appendChild(printNowBtn);

          const headers = document.querySelectorAll('.page-content h3');
          headers.forEach(h3 => {
            for (const key in categoryMap) {
              if (h3.textContent.includes(categoryMap[key])) {
                const table = h3.nextElementSibling;
                if (table && table.tagName === 'TABLE') {
                  printShortcutsContent.appendChild(h3.cloneNode(true));
                  printShortcutsContent.appendChild(table.cloneNode(true));
                }
                break;
              }
            }
          });

          printShortcutsModal.classList.add('visible');
          document.body.classList.add('printing-shortcuts');
        });
      }

      if (printShortcutsClose) {
        printShortcutsClose.addEventListener('click', () => {
          printShortcutsModal.classList.remove('visible');
          document.body.classList.remove('printing-shortcuts');
        });
      }

      // Keyboard Visualizer Logic
      const kbVisualizer = document.getElementById('keyboard-visualizer');
      const kbToggleBtn = document.getElementById('keyboard-toggle-btn');
      const keys = document.querySelectorAll('.kb-key');

      if (kbToggleBtn) {
        kbToggleBtn.addEventListener('click', () => {
          kbVisualizer.classList.toggle('visible');
          kbToggleBtn.classList.toggle('active');
        });
      }

      function highlightKeys(shortcut) {
        keys.forEach(k => k.classList.remove('active'));
        if (!shortcut) return;

        const parts = shortcut.toLowerCase().split(/[+\s]+/);
        
        parts.forEach(part => {
          let key = part.trim();
          if (!key) return;
          
          if (['‚åò', 'cmd', 'command'].includes(key)) key = 'cmd';
          else if (['‚å•', 'opt', 'option'].includes(key)) key = 'opt';
          else if (['‚åÉ', 'ctrl', 'control'].includes(key)) key = 'ctrl';
          else if (['‚áß', 'shift'].includes(key)) key = 'shift';
          else if (['return', 'enter'].includes(key)) key = 'return';
          else if (['space', 'spacebar'].includes(key)) key = 'space';
          else if (['delete', 'del', 'backspace'].includes(key)) key = 'delete';
          else if (['caps', 'caps lock'].includes(key)) key = 'caps';
          else if (['‚Üê', 'left'].includes(key)) key = 'left';
          else if (['‚Üë', 'up'].includes(key)) key = 'up';
          else if (['‚Üì', 'down'].includes(key)) key = 'down';
          else if (['‚Üí', 'right'].includes(key)) key = 'right';
          else if (['fn'].includes(key)) key = 'fn';
          else if (['tab'].includes(key)) key = 'tab';
          
          const keyEls = document.querySelectorAll(`.kb-key[data-key="${key}"]`);
          keyEls.forEach(el => el.classList.add('active'));
        });
      }

      // Add Hover Listeners to Shortcuts Tables
      document.querySelectorAll('.shortcuts-table').forEach(table => {
        table.querySelectorAll('tbody tr').forEach(tr => {
          tr.addEventListener('mouseenter', () => {
            if (kbVisualizer.classList.contains('visible')) {
              highlightKeys(tr.cells[0].textContent);
            }
          });
          tr.addEventListener('mouseleave', () => {
            if (kbVisualizer.classList.contains('visible')) {
              keys.forEach(k => k.classList.remove('active'));
            }
          });
        });
      });

      // --- Visualizer Advanced Features (Macro & Game) ---
      const vizMacroBtn = document.getElementById('viz-macro-btn');
      const vizGameBtn = document.getElementById('viz-game-btn');
      const macroLog = document.getElementById('macro-log');
      const gameUI = document.getElementById('game-ui');
      const gameQuestion = document.getElementById('game-question');
      const gameFeedback = document.getElementById('game-feedback');
      const gameScoreEl = document.getElementById('game-score');
      const gameSkipBtn = document.getElementById('game-skip-btn');

      let isRecording = false;
      let isGaming = false;
      let gameScore = 0;
      let gameQuestions = [];
      let currentQuestion = null;
      let pressedKeys = new Set();

      // Helper: Map Event Key to Visualizer Data-Key
      function getVizKey(e) {
        const key = e.key.toLowerCase();
        if (key === 'meta') return 'cmd';
        if (key === 'control') return 'ctrl';
        if (key === 'alt') return 'opt';
        if (key === 'shift') return 'shift';
        if (key === 'enter') return 'return';
        if (key === ' ') return 'space';
        if (key === 'backspace') return 'delete';
        if (key === 'tab') return 'tab';
        if (key === 'capslock') return 'caps';
        if (key === 'arrowup') return 'up';
        if (key === 'arrowdown') return 'down';
        if (key === 'arrowleft') return 'left';
        if (key === 'arrowright') return 'right';
        if (key === 'escape') return 'esc';
        if (key.length === 1) return key; // Alphanumeric
        return null;
      }

      // Macro Recorder Logic
      vizMacroBtn.addEventListener('click', () => {
        isRecording = !isRecording;
        vizMacroBtn.classList.toggle('active', isRecording);
        vizMacroBtn.textContent = isRecording ? '‚èπ Stop Recording' : 'üî¥ Record Macro';
        macroLog.style.display = isRecording ? 'block' : 'none';
        if (isRecording) {
          macroLog.textContent = '';
          if (isGaming) vizGameBtn.click(); // Disable game if active
        }
      });

      // Game Mode Logic
      function parseQuestions() {
        gameQuestions = [];
        document.querySelectorAll('.shortcuts-table tbody tr').forEach(tr => {
          const shortcutText = tr.cells[0].textContent.trim();
          const actionText = tr.cells[1].textContent.trim();
          
          // Normalize shortcut text to key set
          const parts = shortcutText.toLowerCase().split(/[+\s]+/);
          const keySet = new Set();
          parts.forEach(p => {
            let k = p.trim();
            if (!k) return;
            if (['‚åò', 'cmd', 'command'].includes(k)) k = 'cmd';
            else if (['‚å•', 'opt', 'option'].includes(k)) k = 'opt';
            else if (['‚åÉ', 'ctrl', 'control'].includes(k)) k = 'ctrl';
            else if (['‚áß', 'shift'].includes(k)) k = 'shift';
            else if (['return', 'enter'].includes(k)) k = 'return';
            else if (['space', 'spacebar'].includes(k)) k = 'space';
            else if (['delete', 'del', 'backspace'].includes(k)) k = 'delete';
            else if (['caps', 'caps lock'].includes(k)) k = 'caps';
            else if (['‚Üê', 'left'].includes(k)) k = 'left';
            else if (['‚Üë', 'up'].includes(k)) k = 'up';
            else if (['‚Üì', 'down'].includes(k)) k = 'down';
            else if (['‚Üí', 'right'].includes(k)) k = 'right';
            else if (['fn'].includes(k)) k = 'fn';
            keySet.add(k);
          });
          
          if (keySet.size > 0) {
            gameQuestions.push({ shortcut: keySet, action: actionText, text: shortcutText });
          }
        });
      }

      function nextQuestion() {
        if (gameQuestions.length === 0) parseQuestions();
        const idx = Math.floor(Math.random() * gameQuestions.length);
        currentQuestion = gameQuestions[idx];
        gameQuestion.textContent = `Action: ${currentQuestion.action}`;
        gameFeedback.textContent = '';
        gameFeedback.className = '';
        pressedKeys.clear();
        updateVizKeys();
      }

      function updateVizKeys() {
        document.querySelectorAll('.kb-key').forEach(k => k.classList.remove('active'));
        pressedKeys.forEach(k => {
          document.querySelectorAll(`.kb-key[data-key="${k}"]`).forEach(el => el.classList.add('active'));
        });
      }

      function checkAnswer() {
        if (!currentQuestion) return;
        if (pressedKeys.size !== currentQuestion.shortcut.size) return;
        
        let match = true;
        for (let k of currentQuestion.shortcut) {
          if (!pressedKeys.has(k)) { match = false; break; }
        }
        
        if (match) {
          gameFeedback.textContent = 'Correct! üéâ';
          gameFeedback.className = 'feedback-correct';
          gameScore++;
          gameScoreEl.textContent = `Score: ${gameScore}`;
          setTimeout(nextQuestion, 1000);
        }
      }

      vizGameBtn.addEventListener('click', () => {
        isGaming = !isGaming;
        vizGameBtn.classList.toggle('active', isGaming);
        gameUI.style.display = isGaming ? 'block' : 'none';
        if (isGaming) {
          if (isRecording) vizMacroBtn.click();
          parseQuestions();
          gameScore = 0;
          gameScoreEl.textContent = `Score: ${gameScore}`;
          nextQuestion();
        }
      });

      gameSkipBtn.addEventListener('click', () => {
        gameFeedback.textContent = `Skipped! Shortcut: ${currentQuestion.text}`;
        gameFeedback.className = 'feedback-wrong';
        setTimeout(nextQuestion, 2500);
      });

      // Global Key Listener for Features
      document.addEventListener('keydown', (e) => {
        if (!isRecording && !isGaming) return;
        if (e.repeat) return;

        const vizKey = getVizKey(e);
        if (!vizKey) return;

        if (isRecording) {
          e.preventDefault();
          const keyEls = document.querySelectorAll(`.kb-key[data-key="${vizKey}"]`);
          keyEls.forEach(el => {
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 200);
          });
          const displayKey = keyEls.length > 0 ? keyEls[0].textContent : vizKey;
          macroLog.textContent += (macroLog.textContent ? ' + ' : '') + displayKey;
        }

        if (isGaming) {
          e.preventDefault();
          if (!pressedKeys.has(vizKey)) {
            pressedKeys.add(vizKey);
            updateVizKeys();
            checkAnswer();
          }
        }
      });

      document.addEventListener('keyup', (e) => {
        if (!isGaming) return;
        const vizKey = getVizKey(e);
        if (vizKey && pressedKeys.has(vizKey)) {
          pressedKeys.delete(vizKey);
          updateVizKeys();
        }
      });

      // Mobile FAB Logic
      const fabMain = document.getElementById('mobile-fab-main');
      const fabMenu = document.getElementById('mobile-fab-menu');
      const fabToc = document.getElementById('fab-toc-btn');
      const fabSearch = document.getElementById('fab-search-btn');
      const fabSettings = document.getElementById('fab-settings-btn');

      fabMain.addEventListener('click', () => {
        fabMain.classList.toggle('active');
        fabMenu.classList.toggle('visible');
      });

      fabToc.addEventListener('click', () => {
        toggleMobileMenu();
        fabMain.click(); // Close menu
      });
      fabSearch.addEventListener('click', () => {
        document.getElementById('search-input').focus();
        fabMain.click();
      });
      fabSettings.addEventListener('click', () => {
        document.getElementById('settings-btn').click();
        fabMain.click();
      });
    </script>
    
    {% if site.google_analytics %}
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
</html>
