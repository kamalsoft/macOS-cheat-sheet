<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    {% seo %}
    <link rel="stylesheet" href="{{ '/assets/styles.css' | relative_url }}">
  </head>
  <body>
    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>
    <button id="exit-zen-btn">Exit Zen Mode</button>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">{{ site.title | default: site.github.repository_name }}</h1>
      <h2 class="project-tagline">{{ site.description | default: site.github.project_tagline }}</h2>
      <p id="reading-time" style="margin-top: 0.5rem; opacity: 0.9; font-size: 0.9rem; font-weight: 500;"></p>
      
      {% if site.show_downloads %}
        <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
        <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
      {% endif %}

      <div class="controls-container">
        <input type="text" id="search-input" placeholder="ðŸ” Search cheat sheet...">
        <button id="share-btn">ðŸ”— Share</button>
        <button id="zen-mode-toggle">ðŸ§˜ Zen Mode</button>
        <button id="dark-mode-toggle">ðŸŒ™ Dark Mode</button>
      </div>
      
      <!-- <a href="https://github.com/kamalsoft/macOS-cheat-sheet" class="btn">View on GitHub</a> -->
    </header>

    <main id="content" class="main-content" role="main">
      <div class="page-layout">
        <aside id="toc-sidebar" class="toc-sidebar">
          <ul id="toc-list"></ul>
        </aside>
        <div class="page-content">
          {{ content }}
        </div>
      </div>

      <footer class="site-footer">
        {% if site.github.is_project_page %}
          <span class="site-footer-owner"><a href="#">{{ site.github.repository_name }}</a> is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a>.</span>
        {% endif %}
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
        <span class="site-footer-credits" style="display: block; margin-top: 10px; opacity: 0.8;">Last Updated: {{ site.time | date: "%B %d, %Y" }}</span>
      </footer>
    </main>

    <button id="back-to-top" aria-label="Back to Top">â†‘</button>
    
    <!-- Back to Top Button Script -->
    <script>
      // Scroll Progress Bar Logic
      window.addEventListener('scroll', () => {
        const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        document.getElementById("progress-bar").style.width = scrolled + "%";
      });

      // Back to Top Button Logic
      const backToTopBtn = document.getElementById('back-to-top');
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          backToTopBtn.classList.add('visible');
        } else {
          backToTopBtn.classList.remove('visible');
        }
      });

      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
              e.preventDefault();
              document.querySelector(this.getAttribute('href')).scrollIntoView({
                  behavior: 'smooth'
              });
          });
      });
    </script>

    <!-- Dark Mode & Search Script -->
    <script>
      // Dark Mode Logic
      const toggleBtn = document.getElementById('dark-mode-toggle');
      const html = document.documentElement;
      
      // Check saved preference
      if (localStorage.getItem('theme') === 'dark') {
        html.setAttribute('data-theme', 'dark');
        toggleBtn.textContent = 'â˜€ï¸ Light Mode';
      }

      toggleBtn.addEventListener('click', () => {
        if (html.getAttribute('data-theme') === 'dark') {
          html.removeAttribute('data-theme');
          localStorage.setItem('theme', 'light');
          toggleBtn.textContent = 'ðŸŒ™ Dark Mode';
        } else {
          html.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
          toggleBtn.textContent = 'â˜€ï¸ Light Mode';
        }
      });

      // Search Logic
      const searchInput = document.getElementById('search-input');
      const mainContent = document.querySelector('.page-content');
      
      // Wrap content in sections for filtering
      // We assume sections start with H2
      const children = Array.from(mainContent.children);
      let currentWrapper = null;

      children.forEach(child => {
        if (child.tagName === 'H2') {
          currentWrapper = document.createElement('div');
          currentWrapper.className = 'searchable-section';
          mainContent.insertBefore(currentWrapper, child);
          currentWrapper.appendChild(child);
        } else if (currentWrapper && child.tagName !== 'FOOTER') {
          currentWrapper.appendChild(child);
        }
      });

      searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        document.querySelectorAll('.searchable-section').forEach(section => {
          const text = section.innerText.toLowerCase();
          section.style.display = text.includes(term) ? '' : 'none';
        });
      });

      // Keyboard Shortcut to Focus Search
      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && document.activeElement !== searchInput) {
          e.preventDefault();
          searchInput.focus();
        }
      });

      // Zen Mode Logic
      const zenToggle = document.getElementById('zen-mode-toggle');
      const exitZenBtn = document.getElementById('exit-zen-btn');
      
      function toggleZenMode() {
        document.body.classList.toggle('zen-mode');
      }

      zenToggle.addEventListener('click', toggleZenMode);
      exitZenBtn.addEventListener('click', toggleZenMode);
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.body.classList.contains('zen-mode')) {
          toggleZenMode();
        }
      });

      // Share Button Logic
      const shareBtn = document.getElementById('share-btn');
      shareBtn.addEventListener('click', () => {
        const activeLink = document.querySelector('.toc-sidebar a.active');
        let url = window.location.href.split('#')[0];
        if (activeLink) {
          url += activeLink.getAttribute('href');
        }
        navigator.clipboard.writeText(url).then(() => {
          const originalText = shareBtn.textContent;
          shareBtn.textContent = 'âœ… Copied!';
          setTimeout(() => shareBtn.textContent = originalText, 2000);
        });
      });
    </script>

    <!-- TOC & Copy Button Script -->
    <script>
      // Generate TOC
      const tocList = document.getElementById('toc-list');
      const headers = document.querySelectorAll('.page-content h2');
      
      headers.forEach(header => {
        if (header.id) {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.textContent = header.textContent;
          a.href = '#' + header.id;
          li.appendChild(a);
          tocList.appendChild(li);
        }
      });

      // Highlight Active TOC Item
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            document.querySelectorAll('.toc-sidebar a').forEach(link => link.classList.remove('active'));
            const id = entry.target.id;
            const link = document.querySelector(`.toc-sidebar a[href="#${id}"]`);
            if (link) link.classList.add('active');
          }
        });
      }, { rootMargin: '-100px 0px -66%' });

      headers.forEach(header => observer.observe(header));

      // Copy to Clipboard Buttons
      document.querySelectorAll('pre').forEach(pre => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-container';
        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);
        
        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.textContent = 'Copy';
        button.addEventListener('click', () => {
          const code = pre.querySelector('code') ? pre.querySelector('code').innerText : pre.innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => button.textContent = 'Copy', 2000);
          });
        });
        wrapper.appendChild(button);
      });

      // Reading Time Estimator
      function calculateReadingTime() {
        const text = document.querySelector('.page-content').innerText;
        const wpm = 200;
        const words = text.trim().split(/\s+/).length;
        const time = Math.ceil(words / wpm);
        document.getElementById('reading-time').innerText = `ðŸ“š Estimated reading time: ${time} min`;
      }
      calculateReadingTime();
    </script>
    
    {% if site.google_analytics %}
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
</html>
